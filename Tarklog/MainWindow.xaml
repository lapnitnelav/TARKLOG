<Window x:Class="Tarklog.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Tarklog"
        xmlns:oxy="clr-namespace:OxyPlot.Wpf;assembly=OxyPlot.Wpf"
        mc:Ignorable="d"
        Title="Tarklog - Log File Manager" Height="700" Width="1200" WindowStartupLocation="CenterScreen">
    <Grid Background="#F5F5F5">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#2196F3">
            <TextBlock Text="Tarklog - Log File Manager" FontSize="24" FontWeight="Bold" Foreground="White" Margin="20"/>
        </Border>

        <!-- Main Content with Tabs -->
        <TabControl Grid.Row="1" Margin="0">
            <!-- Summary Tab -->
            <TabItem Header="Summary">
                <Border Padding="40" Background="White">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="Most Recent Raid" FontSize="24" FontWeight="Bold" Margin="0,0,0,40" HorizontalAlignment="Center" Foreground="#1976D2"/>

                        <Border BorderBrush="#2196F3" BorderThickness="2" CornerRadius="8" Padding="40" Margin="0,0,0,30" Background="#F9FAFB">
                            <TextBlock Name="SummaryTextBlock"
                                       Text="No raid data available"
                                       FontSize="20"
                                       TextWrapping="Wrap"
                                       LineHeight="32"
                                       HorizontalAlignment="Center"
                                       TextAlignment="Center"
                                       Foreground="#333"/>
                        </Border>

                        <Button Content="Refresh" Padding="20,12" Background="#2196F3" Foreground="White" FontSize="14" HorizontalAlignment="Center" Click="RefreshButton_Click" MinWidth="150"/>
                    </StackPanel>
                </Border>
            </TabItem>

            <!-- Map Distribution Tab -->
            <TabItem Header="Map Distribution">
                <Border Padding="15" Background="White">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Date Range Filter -->
                        <Border Grid.Row="0" Background="#F5F5F5" Padding="12" Margin="0,0,0,10" CornerRadius="5">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Show last:" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ComboBox x:Name="MapDaysCombo" Width="100" IsEditable="True" Text="All">
                                    <ComboBoxItem Content="All" IsSelected="True"/>
                                    <ComboBoxItem Content="7"/>
                                    <ComboBoxItem Content="14"/>
                                    <ComboBoxItem Content="30"/>
                                    <ComboBoxItem Content="60"/>
                                    <ComboBoxItem Content="90"/>
                                    <ComboBoxItem Content="180"/>
                                    <ComboBoxItem Content="365"/>
                                </ComboBox>
                                <TextBlock Text="days" FontWeight="Bold" VerticalAlignment="Center" Margin="10,0,15,0"/>
                                <Button Content="Apply" Padding="10,5" Background="#2196F3" Foreground="White" Click="MapApplyFilter_Click"/>

                                <!-- Separator -->
                                <Border Width="1" Background="#DDD" Margin="20,0"/>

                                <!-- Date Range Picker -->
                                <TextBlock Text="Or date range:" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <DatePicker x:Name="MapStartDatePicker" Width="120" Margin="0,0,10,0"/>
                                <TextBlock Text="to" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <DatePicker x:Name="MapEndDatePicker" Width="120" Margin="0,0,10,0"/>
                                <Button Content="Apply" Padding="10,5" Background="#2196F3" Foreground="White" Click="MapApplyDateRange_Click"/>
                            </StackPanel>
                        </Border>

                        <!-- Charts and Stats -->
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="480"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Left side: Pie Chart -->
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Map Distribution Chart" FontSize="16" FontWeight="Bold" Margin="0,0,0,4"/>
                                <TextBlock x:Name="MapDateRangeLabel" Text="Date Range: N/A" FontSize="11" Foreground="#666" Margin="0,0,0,10"/>
                                <oxy:PlotView x:Name="MapDistributionPlot" Height="360" Background="White"/>
                            </StackPanel>

                            <!-- Right side: Statistics Table -->
                            <StackPanel Grid.Column="1" Margin="20,0,0,0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                    <TextBlock Text="Map Statistics" FontSize="16" FontWeight="Bold"/>
                                    <TextBlock x:Name="MapTotalCountLabel" Text="" FontSize="13" Foreground="#666" Margin="12,2,0,0"/>
                                </StackPanel>
                                <TextBlock Text="" FontSize="11" Margin="0,0,0,10"/>
                                <DataGrid x:Name="MapStatsGrid"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          HeadersVisibility="Column"
                                          GridLinesVisibility="Horizontal"
                                          BorderBrush="#E0E0E0"
                                          BorderThickness="1"
                                          Background="White"
                                          AlternatingRowBackground="#F9F9F9"
                                          FontSize="13">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Map Name" Binding="{Binding MapName}" Width="*" FontWeight="Bold"/>
                                        <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="100"/>
                                        <DataGridTextColumn Header="Percentage" Binding="{Binding Percentage}" SortMemberPath="PercentageValue" Width="120"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Border>
            </TabItem>

            <!-- Server Distribution Tab -->
            <TabItem Header="Server Distribution">
                <Border Padding="15" Background="White">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Date Range Filter -->
                        <Border Grid.Row="0" Background="#F5F5F5" Padding="12" Margin="0,0,0,10" CornerRadius="5">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Show last:" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ComboBox x:Name="ServerDaysCombo" Width="100" IsEditable="True" Text="All">
                                    <ComboBoxItem Content="All" IsSelected="True"/>
                                    <ComboBoxItem Content="7"/>
                                    <ComboBoxItem Content="14"/>
                                    <ComboBoxItem Content="30"/>
                                    <ComboBoxItem Content="60"/>
                                    <ComboBoxItem Content="90"/>
                                    <ComboBoxItem Content="180"/>
                                    <ComboBoxItem Content="365"/>
                                </ComboBox>
                                <TextBlock Text="days" FontWeight="Bold" VerticalAlignment="Center" Margin="10,0,15,0"/>
                                <Button Content="Apply" Padding="10,5" Background="#2196F3" Foreground="White" Click="ServerApplyFilter_Click"/>

                                <!-- Separator -->
                                <Border Width="1" Background="#DDD" Margin="20,0"/>

                                <!-- Date Range Picker -->
                                <TextBlock Text="Or date range:" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <DatePicker x:Name="ServerStartDatePicker" Width="120" Margin="0,0,10,0"/>
                                <TextBlock Text="to" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <DatePicker x:Name="ServerEndDatePicker" Width="120" Margin="0,0,10,0"/>
                                <Button Content="Apply" Padding="10,5" Background="#2196F3" Foreground="White" Click="ServerApplyDateRange_Click"/>
                            </StackPanel>
                        </Border>

                        <!-- Charts and Stats -->
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="480"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Left side: Pie Chart -->
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Server Distribution Chart" FontSize="16" FontWeight="Bold" Margin="0,0,0,4"/>
                                <TextBlock x:Name="ServerDateRangeLabel" Text="Date Range: N/A" FontSize="11" Foreground="#666" Margin="0,0,0,10"/>
                                <oxy:PlotView x:Name="ServerDistributionPlot" Height="360" Background="White"/>
                            </StackPanel>

                            <!-- Right side: Statistics Table -->
                            <StackPanel Grid.Column="1" Margin="20,0,0,0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                    <TextBlock Text="Server Statistics" FontSize="16" FontWeight="Bold"/>
                                    <TextBlock x:Name="ServerTotalCountLabel" Text="" FontSize="13" Foreground="#666" Margin="12,2,0,0"/>
                                </StackPanel>
                                <TextBlock Text="" FontSize="11" Margin="0,0,0,10"/>
                                <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="450">
                                    <DataGrid x:Name="ServerStatsGrid"
                                              AutoGenerateColumns="False"
                                              IsReadOnly="True"
                                              HeadersVisibility="Column"
                                              GridLinesVisibility="Horizontal"
                                              BorderBrush="#E0E0E0"
                                              BorderThickness="1"
                                              Background="White"
                                              AlternatingRowBackground="#F9F9F9"
                                              FontSize="13">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Country" Binding="{Binding CountryName}" Width="*" FontWeight="Bold"/>
                                            <DataGridTextColumn Header="City" Binding="{Binding CityCode}" Width="100"/>
                                            <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="100"/>
                                            <DataGridTextColumn Header="Percentage" Binding="{Binding Percentage}" SortMemberPath="PercentageValue" Width="120"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </ScrollViewer>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Border>
            </TabItem>

            <!-- Recent Entries Tab -->
            <TabItem Header="Recent Entries">
                <Border Padding="20" Background="White">
                    <StackPanel>
                        <TextBlock Text="Recent Raid Entries" FontSize="18" FontWeight="Bold" Margin="0,0,0,15"/>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBlock Text="Show last:" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <ComboBox x:Name="TimelineEntriesCombo" Width="100" SelectionChanged="TimelineEntriesCombo_SelectionChanged" IsEditable="True" Text="5">
                                <ComboBoxItem Content="5" IsSelected="True"/>
                                <ComboBoxItem Content="10"/>
                                <ComboBoxItem Content="15"/>
                                <ComboBoxItem Content="20"/>
                                <ComboBoxItem Content="50"/>
                            </ComboBox>
                            <TextBlock Text="entries" FontWeight="Bold" VerticalAlignment="Center" Margin="10,0,15,0"/>
                            <Button Content="Apply" Padding="10,5" Background="#2196F3" Foreground="White" Click="TimelineApplyFilter_Click"/>
                        </StackPanel>

                        <DataGrid x:Name="TimelineGrid"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  Height="500"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="Horizontal"
                                  BorderBrush="#E0E0E0"
                                  BorderThickness="1"
                                  Background="White"
                                  AlternatingRowBackground="#F9F9F9"
                                  FontSize="13">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}" Width="180"/>
                                <DataGridTextColumn Header="Map" Binding="{Binding Map}" Width="150" FontWeight="Bold"/>
                                <DataGridTextColumn Header="Country" Binding="{Binding Country}" Width="150"/>
                                <DataGridTextColumn Header="City" Binding="{Binding City}" Width="100"/>
                                <DataGridTextColumn Header="Raid ID" Binding="{Binding RaidId}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>
            </TabItem>

            <!-- Settings Tab -->
            <TabItem Header="Settings &amp; Directories">
                <Border Padding="20" Background="White">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="400"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Settings Panel -->
                        <StackPanel Grid.Column="0" VerticalAlignment="Top">
                            <TextBlock Text="Configuration" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Tarkov Log Directory" FontWeight="Bold"/>
                                <TextBlock Text="ℹ" FontSize="14" Foreground="#2196F3" Margin="5,0,0,0" Cursor="Help">
                                    <TextBlock.ToolTip>
                                        <ToolTip>
                                            <StackPanel MaxWidth="400">
                                                <TextBlock Text="How to find the log directory:" FontWeight="Bold" Margin="0,0,0,8"/>
                                                <Image Source="Data/tooltip_where_log.png" Stretch="Uniform" Margin="0,0,0,0"/>
                                            </StackPanel>
                                        </ToolTip>
                                    </TextBlock.ToolTip>
                                </TextBlock>
                            </StackPanel>
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Name="LogRootTextBox" Grid.Column="0" Padding="8" Background="#F5F5F5" BorderBrush="#DDD" Height="36"/>
                                <Button Grid.Column="1" Content="Browse" Padding="15,8" Background="#2196F3" Foreground="White" Margin="10,0,0,0" Width="90" Click="BrowseLogRoot_Click"/>
                            </Grid>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Log Long Term Storage Directory" FontWeight="Bold"/>
                                <TextBlock Text="ℹ" FontSize="14" Foreground="#2196F3" Margin="5,0,0,0" Cursor="Help">
                                    <TextBlock.ToolTip>
                                        <ToolTip>
                                            <StackPanel MaxWidth="350">
                                                <TextBlock TextWrapping="Wrap" FontWeight="Bold" Margin="0,0,0,8">
                                                    Long-term storage for old log directories
                                                </TextBlock>
                                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,8">
                                                    This directory stores older log folders that have been moved from the Tarkov log directory to keep it clean and improve game performance.
                                                </TextBlock>
                                                <TextBlock TextWrapping="Wrap" FontWeight="SemiBold">
                                                    This can be stored anywhere, including external drives or network locations.
                                                </TextBlock>
                                            </StackPanel>
                                        </ToolTip>
                                    </TextBlock.ToolTip>
                                </TextBlock>
                            </StackPanel>
                            <Grid Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Name="LogStorageTextBox" Grid.Column="0" Padding="8" Background="#F5F5F5" BorderBrush="#DDD" Height="36"/>
                                <Button Grid.Column="1" Content="Browse" Padding="15,8" Background="#2196F3" Foreground="White" Margin="10,0,0,0" Width="90" Click="BrowseLogStorage_Click"/>
                            </Grid>

                            <CheckBox Name="ClearBeforeScanCheckBox" Content="Clear database before scanning (remove all existing entries)" Margin="0,0,0,10" FontSize="12"/>

                            <Button Content="Scan All Directories" Padding="12,10" Background="#1976D2" Foreground="White" Click="ScanAllDirectories_Click" FontSize="13" FontWeight="Bold" Margin="0,0,0,10"/>

                            <Button Content="Move logs to backup" Padding="12,10" Background="#F57C00" Foreground="White" Click="CleanupOldDirectories_Click" FontSize="13" FontWeight="Bold" Margin="0,0,0,20"/>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Auto-refresh Interval (seconds)" FontWeight="Bold"/>
                                <TextBlock Text="ℹ" FontSize="14" Foreground="#2196F3" Margin="5,0,0,0" Cursor="Help">
                                    <TextBlock.ToolTip>
                                        <ToolTip>
                                            <StackPanel MaxWidth="300">
                                                <TextBlock TextWrapping="Wrap" FontWeight="Bold" Margin="0,0,0,8">
                                                    Automatic Log Scanning
                                                </TextBlock>
                                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,8">
                                                    Set how often the app scans for new raid entries in the log directory.
                                                </TextBlock>
                                                <TextBlock TextWrapping="Wrap" FontWeight="SemiBold">
                                                    Enter 0 to disable auto-refresh, or a positive number (in seconds) to enable. Default: 300 (5 minutes)
                                                </TextBlock>
                                            </StackPanel>
                                        </ToolTip>
                                    </TextBlock.ToolTip>
                                </TextBlock>
                            </StackPanel>
                            <TextBox Name="RefreshIntervalTextBox" Text="300" Padding="8" Background="#F5F5F5" BorderBrush="#DDD" Height="36" Margin="0,0,0,20"/>

                            <Separator Margin="0,0,0,15"/>

                            <StackPanel Orientation="Horizontal">
                                <Button Content="Save Settings" Padding="15,8" Background="#4CAF50" Foreground="White" Width="120" Click="SaveSettings_Click"/>
                                <Button Content="Cancel" Padding="15,8" Background="#999" Foreground="White" Width="90" Margin="10,0,0,0" Click="CancelSettings_Click"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Directory Browse Results -->
                        <StackPanel Grid.Column="1" Margin="20,0,0,0">
                            <TextBlock Text="Directory Contents" FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>
                            
                            <TextBlock Name="DirectoryStatusLabel" Text="No directory selected" Foreground="#666" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Subdirectories:" FontWeight="Bold" Margin="0,0,0,8"/>
                            <ListBox Name="SubdirectoriesList" Height="200" Background="#F9F9F9" BorderBrush="#E0E0E0" Margin="0,0,0,15">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                                            <StackPanel>
                                                <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding FileCount, StringFormat='Files: {0}'}" FontSize="12" Foreground="#999"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                            <TextBlock Text="Log Files Found:" FontWeight="Bold" Margin="0,0,0,8"/>
                            <ListBox Name="LogFilesList" Height="150" Background="#F9F9F9" BorderBrush="#E0E0E0">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                                            <StackPanel>
                                                <TextBlock Text="{Binding FileName}" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding LastModified, StringFormat='Modified: {0:G}'}" FontSize="11" Foreground="#999"/>
                                                <TextBlock Text="{Binding SizeBytes}" FontSize="11" Foreground="#999"/>
                                                <TextBlock Text="{Binding ItemsFound, StringFormat='Parsed items: {0}'}" FontSize="11" Foreground="#4CAF50" FontWeight="Bold"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </StackPanel>
                    </Grid>
                </Border>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
